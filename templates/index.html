<!DOCTYPE html>
<html>
<head>
    <title>Диагностика пневмонии</title>
    <style>
        body {
            font-family: Arial;
            margin: 40px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        button {
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .history-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Диагностика пневмонии по рентгеновским снимкам</h1>

        <!-- Форма загрузки -->
        <div class="section">
            <h2>Загрузите рентгеновский снимок</h2>
            <form method="post" action="/upload" enctype="multipart/form-data">
                <input type="file" name="file" accept="image/*" required style="margin: 10px 0;"><br>
                <button type="submit">Анализировать снимок</button>
            </form>
        </div>

        {% if message %}
        <div class="section" style="background: #e8f5e8;">
            {{ message }}
        </div>
        {% endif %}

        {% if diagnosis %}
        <!-- Результат анализа -->
        <div class="section">
            <h2>Результат анализа</h2>
            <div style="font-size: 24px; font-weight: bold; color: {% if diagnosis == 'Пневмония' %}#f44336{% else %}#4CAF50{% endif %}; padding: 20px; background: {% if diagnosis == 'Пневмония' %}#ffebee{% else %}#e8f5e8{% endif %}; border-radius: 10px;">
                {{ diagnosis }} (вероятность: {{ "%.2f"|format(probability) }}%)
            </div>

            {% if image_path %}
            <div style="text-align: center; margin: 20px 0;">
                <img src="{{ url_for('static', filename='uploads/' + image_path) }}"
                     style="max-width: 400px; max-height: 400px; border-radius: 8px; border: 2px solid #ddd;">
            </div>
            {% endif %}
        </div>

        <!-- Статистика -->
        <div class="section">
            <h2>Статистика анализов</h2>
            <div class="stats">
                <div class="stat-card">
                    <div style="font-size: 20px; font-weight: bold;">{{ total }}</div>
                    <div>Всего анализов</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 20px; font-weight: bold; color: #f44336;">{{ pneumonia_count }}</div>
                    <div>Случаев пневмонии</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 20px; font-weight: bold; color: #4CAF50;">{{ normal_count }}</div>
                    <div>Нормальных снимков</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 20px; font-weight: bold; color: #ff9800;">{{ pneumonia_percent }}%</div>
                    <div>Процент пневмонии</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- История анализов -->
        <div class="section">
            <h2>История анализов (последние 5)</h2>
            {% if history %}
            {% for record in history %}
            <div class="history-item">
                <strong>{{ record.filename }}</strong><br>
                {{ record.diagnosis }} ({{ "%.2f"|format(record.probability) }}%)<br>
                <small>{{ record.timestamp }}</small>
            </div>
            {% endfor %}
            {% else %}
            <p>История анализов пуста</p>
            {% endif %}

            <div style="margin-top: 20px;">
                <a href="/clear_history" style="color: #f44336; text-decoration: none;">Очистить историю</a>
            </div>
        </div>
    </div>
</body>
</html>